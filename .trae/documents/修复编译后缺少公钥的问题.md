## 问题原因
- 运行时提示“缺少公钥”，源于 `utils/license.js:64` 的 `verifyLicense` 调用 `loadPublicKey` 未能加载公钥。
- 当前加载优先级：入参 → `PM_LICENSE_PUBLIC_KEY` → `__dirname/../keys/public.pem`；打包配置 `package.json:43-67` 未包含 `keys/**/*`，编译产物找不到该文件。
- 在 macOS/Windows 的图形化启动场景，终端里 `export PM_LICENSE_PUBLIC_KEY=...` 的环境变量不会自动传递到应用进程，导致加载失败。

## 修复方案（三选一，可叠加）
1) 打包携带公钥（推荐）
- 在 `package.json` 的 `build.files` 增加 `"keys/**/*"`，确保 `keys/public.pem` 被打入 `app.asar`。
- 如需原始文件访问（可选），在 `asarUnpack` 增加 `"keys/**/*"`，使其位于 `app.asar.unpacked/keys/public.pem`。

2) 运行时更稳健的路径解析
- 修改 `utils/license.js:5-19` 的 `loadPublicKey`，在现有逻辑前后补充以下探测：
  - `path.join(process.resourcesPath, 'keys', 'public.pem')`（asar内打包场景）
  - `path.join(process.resourcesPath, 'app.asar.unpacked', 'keys', 'public.pem')`（asarUnpack场景）
  - 当存在 `process.env.PM_LICENSE_PUBLIC_KEY_FILE` 时，读取该路径文件内容作为公钥。
- 保持现有优先级不变：函数入参仍最高，随后环境变量，再文件路径。

3) 部署环境变量注入（无需改代码）
- macOS：在 `Info.plist` 写入 `LSEnvironment`（键为 `PM_LICENSE_PUBLIC_KEY`，值为 PEM 文本），或使用启动器脚本设置后再启动应用。
- Windows：设置系统/用户环境变量 `PM_LICENSE_PUBLIC_KEY`；或提供 `.cmd` 启动器预先 `set PM_LICENSE_PUBLIC_KEY=...`。

## 代码修改清单
- `package.json:43-67`：
  - `build.files` 增加：`"keys/**/*"`
  - （可选）`asarUnpack` 增加：`"keys/**/*"`
- `utils/license.js:5-19`：
  - 扩展 `loadPublicKey`：新增对 `process.resourcesPath` 两种路径的探测；支持 `PM_LICENSE_PUBLIC_KEY_FILE` 文件路径环境变量。
- 文档 `docs/license-flow.md`：
  - 增补“生产环境”章节：说明打包携带公钥与 `Info.plist`/启动脚本注入方式；示例不再仅依赖 `export ...`。

## 验证步骤
- 本地：`node tools/generate-keys.js` 生成密钥；开发模式运行确保验证通过。
- 打包：`npm run build:mac` 或 `build:win`；安装后从 GUI 直接启动应用：
  - 若选择方案1：无需环境变量，授权验证通过。
  - 若选择方案2：无需修改打包配置，路径探测找到公钥，验证通过。
  - 若选择方案3：通过 `.plist` 或启动脚本注入环境变量，验证通过。
- 检查日志：`main.js:192, 437, 485` 的三处验证均返回 `valid: true`。

## 兼容性与安全性
- 不改变签名算法与授权码格式；仅增强公钥载入与打包。
- 公钥为公开信息，打包携带不泄露“私钥”。
- 继续支持现有 `PM_LICENSE_PUBLIC_KEY` 注入方式。

## 请确认
- 选择首选方案（建议：1+2 同时启用，最稳健），我将按上述清单修改代码与配置，并更新文档，然后打包验证。